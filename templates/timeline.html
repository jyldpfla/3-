<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>업무 일정 (타임라인) 페이지</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/timeline.css') }}">
</head>
<body>
    {% include 'components/nav.html' %}

    <div class="main-container">
        <h1 class="page-title">업무 일정 (타임라인)</h1>

        <div class="content-wrapper">
            <section class="calendar-section soft-shadow">
                <div class="calendar-header">
                    <button class="nav-btn prev-month" data-year="{{ current_year }}" data-month="{{ current_month }}">&lt;</button>
                    <span class="current-month" data-year="{{ current_year }}" data-month="{{ current_month }}">{{ current_year_month }}</span>
                    <button class="nav-btn next-month" data-year="{{ current_year }}" data-month="{{ current_month }}">&gt;</button>
                </div>
                <div class="calendar-grid">
                    <div class="calendar-day-label">월</div>
                    <div class="calendar-day-label">화</div>
                    <div class="calendar-day-label">수</div>
                    <div class="calendar-day-label">목</div>
                    <div class="calendar-day-label">금</div>
                    <div class="calendar-day-label">토</div>
                    <div class="calendar-day-label">일</div>
                    {% for day in calendar_days %}
                        <div class="calendar-day
                            {% if not day.is_current_month %}other-month{% endif %}
                            {% if day.is_current_day %}selected-day{% endif %}"
                            data-date="{{ day.full_date }}">
                            {{ day.day }}
                        </div>
                    {% endfor %}
                </div>
            </section>

            <aside class="schedule-panel soft-shadow">
                <h2 class="section-title" id="dailyScheduleHeader">이날의 일정 ({{ selected_date_display }})</h2>
                <ul class="daily-schedule-list" id="dailyScheduleList">
                    {% if daily_schedules %}
                        {% for schedule in daily_schedules %}
                        <li class="daily-schedule-item {{ schedule.tag_class }}" data-schedule-id="{{ schedule.schedule_id_param }}">
                            {{ schedule.name }}
                        </li>
                        {% endfor %}
                    {% else %}
                        <li class="no-schedule-message">일정 없음</li>
                    {% endif %}
                </ul>

                <div class="schedule-add-btn-wrapper">
                    <button id="addScheduleBtn" class="btn btn-primary add-schedule-small-btn">일정 추가</button>
                </div>

                <h2 class="section-title">선택된 업무 상세 정보</h2>
                <div id="scheduleDetailCard">
                    {% if selected_schedule_detail %}
                    <div class="schedule-detail-card">
                        <span class="detail-tag {{ selected_schedule_detail.tag_class }}">
                            {{ selected_schedule_detail.schedule_title }} {# 여기서 직접 schedule_title 출력 #}
                        </span>
                        <p class="detail-label">일정: <span class="detail-value">{{ selected_schedule_detail.schedule_name }}</span></p>
                        <p class="detail-label">이름: <span class="detail-value">{{ selected_schedule_detail.person_name }}</span></p>
                        <p class="detail-label">상태: 
                            <span class="detail-value detail-status-tag {{ selected_schedule_detail.status }}">
                                {{ selected_schedule_detail.status }}
                            </span>
                        </p>
                        <p class="detail-label">시작 날짜: <span class="detail-value">{{ selected_schedule_detail.start_date }}</span></p>
                        <p class="detail-label">종료 날짜: <span class="detail-value">{{ selected_schedule_detail.end_date }}</span></p>

                        {# Tasks 필드는 UI에서 제거되었으므로 더 이상 표시하지 않음 #}
                        {% if selected_schedule_detail.content %}
                            <p class="detail-label">내용: <span class="detail-value">{{ selected_schedule_detail.content }}</span></p>
                        {% else %}
                            <p class="detail-label">내용: <span class="detail-value">없음</span></p>
                        {% endif %}
                    </div>
                    {% else %}
                    <p class="no-schedule-selected">일정을 선택해주세요.</p>
                    {% endif %}
                </div>

                <div class="action-buttons">
                    <button id="editScheduleBtn" class="btn btn-secondary action-btn"><i class="fa-solid fa-pen-to-square"></i> 일정 수정</button>
                    <button id="deleteScheduleBtn" class="btn btn-danger action-btn"><i class="fa-solid fa-trash-can"></i> 일정 삭제</button>
                </div>
            </aside>
        </div>
    </div>

    {% include 'components/footer.html' %}

    <div id="selected-schedule-data" style="display: none;"
         data-schedule-id="{{ selected_schedule_detail.schedule_id_param }}"
         data-type="{{ selected_schedule_detail.type }}"
         data-schedule-name="{{ selected_schedule_detail.schedule_name }}"
         data-person-name="{{ selected_schedule_detail.person_name }}" {# 이름 데이터 추가 #}
         data-status="{{ selected_schedule_detail.status }}"
         data-start-date="{{ selected_schedule_detail.start_date_input }}"
         data-end-date="{{ selected_schedule_detail.end_date_input }}"
         data-content="{{ selected_schedule_detail.content if selected_schedule_detail.content is not none else '' }}"
         {# data-tasks, data-member 는 UI에서 제거되었으므로 HTML에서 직접 전달하지 않음 #}
         data-project-title="{{ selected_schedule_detail.schedule_title }}" {# 여기서도 schedule_title 전달 #}
    ></div>

    <div id="scheduleFormModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">일정 추가/수정</h2>
            <div class="form-group">
                <label for="scheduleType">일정 타입</label>
                <select id="scheduleType" class="form-select">
                    <option value="">일정 타입 선택</option>
                    <option value="개인">개인</option>
                    <option value="프로젝트">프로젝트</option>
                </select>
            </div>

            <div id="projectSelectionArea" class="form-group" style="display: none;">
                <label for="scheduleProjectTitle">프로젝트</label>
                <select id="scheduleProjectTitle" class="form-select">
                    <option value="">프로젝트 선택</option>
                    {% for project_title in project_titles %}
                    <option value="{{ project_title }}">{{ project_title }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="scheduleName">일정 이름 <span class="required">(필수)</span></label>
                <input type="text" id="scheduleName" class="form-input" placeholder="일정 이름을 입력하세요.">
            </div>

            <div class="form-group">
                <label for="schedulePersonName">이름 <span class="required">(필수)</span></label>
                <input type="text" id="schedulePersonName" class="form-input" placeholder="이름을 입력하세요.">
            </div>

            <div class="form-group">
                <label for="scheduleStartDate">시작일</label>
                <input type="datetime-local" id="scheduleStartDate" class="form-input">
            </div>
            <div class="form-group">
                <label for="scheduleEndDate">종료일</label>
                <input type="datetime-local" id="scheduleEndDate" class="form-input">
            </div>
            
            <div class="form-group">
                <label for="scheduleContent">내용</label>
                <textarea id="scheduleContent" class="form-textarea" placeholder="내용을 입력하세요." rows="4"></textarea>
            </div>
            
            <div class="form-group">
                <label for="scheduleStatus">상태</label>
                <select id="scheduleStatus" class="form-select">
                    </select>
            </div>
            
            <div class="modal-buttons">
                <button id="saveScheduleBtn" class="btn btn-primary">일정 추가</button>
                <button id="cancelScheduleBtn" class="btn btn-secondary">취소</button>
            </div>
        </div>
    </div>

    <div id="deleteConfirmModal" class="modal">
        <div class="modal-content alert-box danger">
            <p class="alert-message">정말 삭제하시겠습니까?</p>
            <div class="alert-actions">
                <button id="deleteConfirmYesBtn" class="btn btn-danger">YES</button>
                <button id="deleteConfirmNoBtn" class="btn btn-secondary">NO</button>
            </div>
        </div>
    </div>

    <script>
        // Flask에서 전달된 상태 옵션 데이터를 JavaScript 변수로 저장
        const STATUS_OPTIONS_BY_TYPE = {{ status_options_by_type | tojson }};
    </script>
    <script src="{{ url_for('static', filename='timeline.js') }}"></script>
</body>
</html>